{
    "version": "https://jsonfeed.org/version/1",
    "title": "Flttx's Blog â€¢ All posts by \"h5 app\" tag",
    "description": null,
    "home_page_url": "https://flttx.github.io",
    "items": [
        {
            "id": "https://flttx.github.io/2019/08/15/æ‰‹æœºç«¯è°ƒç”¨ç™¾åº¦å›¾ç‰‡è¯†åˆ«API/",
            "url": "https://flttx.github.io/2019/08/15/æ‰‹æœºç«¯è°ƒç”¨ç™¾åº¦å›¾ç‰‡è¯†åˆ«API/",
            "title": "æ‰‹æœºç«¯è°ƒç”¨ç™¾åº¦å›¾ç‰‡è¯†åˆ«API",
            "date_published": "2019-08-15T02:09:02.000Z",
            "content_html": "<p>å› ä¸ºä¸šåŠ¡éœ€æ±‚ï¼Œæœ‰è½¦ç‰Œè¯†åˆ«çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸Šç½‘æ‰¾äº†å›¾ç‰‡è¯†åˆ«çš„è§£å†³æ–¹æ¡ˆï¼Œå‘ç° BAT éƒ½æœ‰ï¼Œä½†æ˜¯ç™¾åº¦çš„å…è´¹æ¬¡æ•°æœ€å¤šï¼Œå¯¹ä¸šåŠ¡æ¥è¯´å°±ç›¸å½“äºå…¨å…è´¹äº†ï¼Œæ‰€ä»¥å°±é€‰æ‹©äº†ç™¾åº¦çš„ APIï¼ŒğŸ˜„ã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<span class="\"exturl\"" data-url="\"aHR0cHM6Ly9haS5iYWlkdS5jb20vZG9jcyMvT0NSLUFQSS90b3AlRTMlODAlODI=\"">https://ai.baidu.com/docs#/OCR-API/topã€‚</span></p>\n<h1 id="\"1æ‹ç…§è·å–å›¾ç‰‡\""><a class="\"markdownIt-Anchor\"" href="\"#1æ‹ç…§è·å–å›¾ç‰‡\"">#</a> 1. æ‹ç…§è·å–å›¾ç‰‡</h1>\n<p>é¡¹ç›®æ˜¯ H5 APPï¼Œæ‹ç…§ç”¨äº† H5 + çš„ apiã€‚</p>\n<figure class="\"highlight" plain\"><table><tr><td class="\"gutter\""><pre><span class="\"line\"">1</span><br><span class="\"line\"">2</span><br><span class="\"line\"">3</span><br><span class="\"line\"">4</span><br><span class="\"line\"">5</span><br><span class="\"line\"">6</span><br><span class="\"line\"">7</span><br><span class="\"line\"">8</span><br><span class="\"line\"">9</span><br><span class="\"line\"">10</span><br><span class="\"line\"">11</span><br><span class="\"line\"">12</span><br><span class="\"line\"">13</span><br><span class="\"line\"">14</span><br><span class="\"line\"">15</span><br><span class="\"line\"">16</span><br><span class="\"line\"">17</span><br></pre></td><td class="\"code\""><pre><span class="\"line\"">//æ‹ç…§</span><br><span class="\"line\"">captureImage() &#123;</span><br><span class="\"line\"">    let _this = this;</span><br><span class="\"line\"">    var cmr = plus.camera.getCamera();</span><br><span class="\"line\"">    var res = cmr.supportedImageResolutions[0];  //æ‘„åƒå¤´æ”¯æŒçš„æ‹ç…§åˆ†è¾¨ç‡</span><br><span class="\"line\"">    var fmt = cmr.supportedImageFormats[0]; //æ‘„åƒå¤´æ”¯æŒçš„æ‹ç…§æ–‡ä»¶æ ¼å¼</span><br><span class="\"line\"">    cmr.captureImage((path)=&gt; &#123;</span><br><span class="\"line\"">            _this.convertUrl(path);</span><br><span class="\"line\"">        &#125;,</span><br><span class="\"line\"">        function(error) &#123;</span><br><span class="\"line\"">            console.log(&quot;Capture image failed: &quot; + error.message);</span><br><span class="\"line\"">        &#125;, &#123;</span><br><span class="\"line\"">            resolution: res,</span><br><span class="\"line\"">            format: fmt</span><br><span class="\"line\"">        &#125;</span><br><span class="\"line\"">    );</span><br><span class="\"line\"">&#125;,</span><br></pre></td></tr></table></figure>\n<h1 id="\"2å›¾ç‰‡è½¬base64\""><a class="\"markdownIt-Anchor\"" href="\"#2å›¾ç‰‡è½¬base64\"">#</a> 2. å›¾ç‰‡è½¬ base64</h1>\n<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œå›¾ç‰‡è¦è½¬æˆ base64 æ•°æ®ã€‚</p>\n<figure class="\"highlight" plain\"><table><tr><td class="\"gutter\""><pre><span class="\"line\"">1</span><br><span class="\"line\"">2</span><br><span class="\"line\"">3</span><br><span class="\"line\"">4</span><br><span class="\"line\"">5</span><br><span class="\"line\"">6</span><br><span class="\"line\"">7</span><br><span class="\"line\"">8</span><br><span class="\"line\"">9</span><br><span class="\"line\"">10</span><br><span class="\"line\"">11</span><br><span class="\"line\"">12</span><br><span class="\"line\"">13</span><br><span class="\"line\"">14</span><br><span class="\"line\"">15</span><br><span class="\"line\"">16</span><br><span class="\"line\"">17</span><br><span class="\"line\"">18</span><br><span class="\"line\"">19</span><br><span class="\"line\"">20</span><br><span class="\"line\"">21</span><br><span class="\"line\"">22</span><br><span class="\"line\"">23</span><br><span class="\"line\"">24</span><br></pre></td><td class="\"code\""><pre><span class="\"line\"">//è½¬æ¢å›¾ç‰‡è·¯å¾„å¹¶è°ƒç”¨æ–¹æ³•è¯†åˆ«</span><br><span class="\"line\"">convertUrl(path)&#123;</span><br><span class="\"line\"">    let _this = this;</span><br><span class="\"line\"">    //è½¬æ¢ä¸ºæœ¬åœ°æ–‡ä»¶è·¯å¾„</span><br><span class="\"line\"">    plus.io.resolveLocalFileSystemURL(path, function(entry) &#123;</span><br><span class="\"line\"">        var localurl = entry.toLocalURL(); </span><br><span class="\"line\"">        var reader = new plus.io.FileReader();  </span><br><span class="\"line\"">        reader.onloadend = function (e) &#123;  </span><br><span class="\"line\"">                var imgData = e.target.result.replace(&quot;data:image/jpeg;base64,&quot;, &quot;&quot;).replace(&quot;data:image/png;base64,&quot;, &quot;&quot;);//base64å›¾ç‰‡  </span><br><span class="\"line\"">                ocr.startOCR(imgData, res=&gt;&#123;</span><br><span class="\"line\"">                var number = res.words_result.number;</span><br><span class="\"line\"">                if(number.length == 7)&#123;</span><br><span class="\"line\"">                    uni.showToast(&#123;</span><br><span class="\"line\"">                        title: &quot;è¯†åˆ«æˆåŠŸ&quot;,</span><br><span class="\"line\"">                        icon: &quot;none&quot;</span><br><span class="\"line\"">                    &#125;)</span><br><span class="\"line\"">                    var values = number.split(&quot;&quot;);</span><br><span class="\"line\"">                    _this.result = values;</span><br><span class="\"line\"">                &#125;</span><br><span class="\"line\"">                &#125;);</span><br><span class="\"line\"">        &#125;;  </span><br><span class="\"line\"">        reader.readAsDataURL(localurl);  </span><br><span class="\"line\"">    &#125;);</span><br><span class="\"line\"">&#125;,</span><br></pre></td></tr></table></figure>\n<h1 id="\"3è·å–access-token\""><a class="\"markdownIt-Anchor\"" href="\"#3è·å–access-token\"">#</a> 3. è·å– Access Token</h1>\n<p>å¥½äº†ï¼Œç°åœ¨å›¾ç‰‡æ•°æ®æœ‰äº†ï¼Œåœ¨è°ƒç™¾åº¦è½¦ç‰Œè¯†åˆ« API ä¹‹å‰è¿˜è¦å…ˆè·å– Access Token, è€Œè¦è·å– Access Tokenï¼Œåˆå¾—å…ˆç™»è®°ä¸€ä¸ªåº”ç”¨ï¼Œå–åˆ°åº”ç”¨çš„ API KEY å’Œ SECRET KEYã€‚</p>\n<figure class="\"highlight" plain\"><table><tr><td class="\"gutter\""><pre><span class="\"line\"">1</span><br><span class="\"line\"">2</span><br><span class="\"line\"">3</span><br><span class="\"line\"">4</span><br><span class="\"line\"">5</span><br><span class="\"line\"">6</span><br><span class="\"line\"">7</span><br><span class="\"line\"">8</span><br><span class="\"line\"">9</span><br><span class="\"line\"">10</span><br><span class="\"line\"">11</span><br><span class="\"line\"">12</span><br><span class="\"line\"">13</span><br><span class="\"line\"">14</span><br><span class="\"line\"">15</span><br><span class="\"line\"">16</span><br><span class="\"line\"">17</span><br><span class="\"line\"">18</span><br><span class="\"line\"">19</span><br><span class="\"line\"">20</span><br><span class="\"line\"">21</span><br><span class="\"line\"">22</span><br><span class="\"line\"">23</span><br><span class="\"line\"">24</span><br><span class="\"line\"">25</span><br></pre></td><td class="\"code\""><pre><span class="\"line\"">//è·å–access_token</span><br><span class="\"line\"">function requestAccessToken(callback) &#123;</span><br><span class="\"line\"">\tlet params = &#123;</span><br><span class="\"line\"">\t\tgrant_type: &apos;client_credentials&apos;,  //å›ºå®šå€¼</span><br><span class="\"line\"">\t\tclient_id: api_key,  //ç™»è®°åº”ç”¨çš„API KEY</span><br><span class="\"line\"">\t\tclient_secret: secret_key //ç™»è®°åº”ç”¨çš„SECRET KEY</span><br><span class="\"line\"">\t&#125;</span><br><span class="\"line\""></span><br><span class="\"line\"">    //networkæ˜¯å°è£…çš„ajaxè¯·æ±‚å‡½æ•°</span><br><span class="\"line\"">\tnetwork.request(&apos;https://aip.baidubce.com/oauth/2.0/token&apos;, params, null, &quot;GET&quot;, res =&gt; &#123;</span><br><span class="\"line\"">\t\tif (res.hasOwnProperty(&apos;access_token&apos;)) &#123;</span><br><span class="\"line\"">\t\t\tlet nowTime = new Date().getTime();  </span><br><span class="\"line\"">            //è®°å½•å½“å‰è¯·æ±‚æ—¶é—´æ˜¯ä¸ºäº†åˆ¤æ–­access_tokenæ˜¯å¦è¿‡æœŸ</span><br><span class="\"line\"">\t\t\tlet access_token_obj = &#123;</span><br><span class="\"line\"">\t\t\t\taccess_token: res.access_token,</span><br><span class="\"line\"">\t\t\t\trequestTime: nowTime  </span><br><span class="\"line\"">\t\t\t&#125;</span><br><span class="\"line\"">\t\t\tuni.setStorageSync(&quot;access_token_obj&quot;, access_token_obj)</span><br><span class="\"line\"">\t\t\tcallback(res.access_token);</span><br><span class="\"line\"">\t\t&#125; else &#123; //è·å–access_tokenå¤±è´¥</span><br><span class="\"line\"">\t\t\tconsole.log(JSON.stringify(res));</span><br><span class="\"line\"">\t\t&#125;</span><br><span class="\"line\""></span><br><span class="\"line\"">\t&#125;);</span><br><span class="\"line\"">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id="\"4è°ƒç”¨è½¦ç‰Œè¯†åˆ«api\""><a class="\"markdownIt-Anchor\"" href="\"#4è°ƒç”¨è½¦ç‰Œè¯†åˆ«api\"">#</a> 4. è°ƒç”¨è½¦ç‰Œè¯†åˆ« API</h1>\n<p>å…ˆåˆ¤æ–­ä¹‹å‰æ˜¯å¦è¯·æ±‚è¿‡ access_tokenï¼Œå¦‚æœè¯·æ±‚è¿‡å†åˆ¤æ–­ access_token æ˜¯å¦è¿‡æœŸã€‚</p>\n<figure class="\"highlight" plain\"><table><tr><td class="\"gutter\""><pre><span class="\"line\"">1</span><br><span class="\"line\"">2</span><br><span class="\"line\"">3</span><br><span class="\"line\"">4</span><br><span class="\"line\"">5</span><br><span class="\"line\"">6</span><br><span class="\"line\"">7</span><br><span class="\"line\"">8</span><br><span class="\"line\"">9</span><br><span class="\"line\"">10</span><br><span class="\"line\"">11</span><br><span class="\"line\"">12</span><br><span class="\"line\"">13</span><br><span class="\"line\"">14</span><br><span class="\"line\"">15</span><br><span class="\"line\"">16</span><br><span class="\"line\"">17</span><br><span class="\"line\"">18</span><br><span class="\"line\"">19</span><br><span class="\"line\"">20</span><br><span class="\"line\"">21</span><br><span class="\"line\"">22</span><br></pre></td><td class="\"code\""><pre><span class="\"line\"">/**</span><br><span class="\"line\""> * å¼€å§‹è¿›è¡Œæ–‡å­—è¯†åˆ«ï¼Œä¼ å…¥base64å›¾ç‰‡æ•°æ®å’Œå›è°ƒå‡½æ•°</span><br><span class="\"line\""> */</span><br><span class="\"line\"">function startOCR(imgData, callback) &#123;</span><br><span class="\"line\"">\tconsole.log(&quot;å¼€å§‹è¯†åˆ«...&quot;);</span><br><span class="\"line\"">\tconsole.log(&quot;access_tokenç¼“å­˜ï¼Ÿ&quot; + uni.getStorageSync(&quot;access_token_obj&quot;));</span><br><span class="\"line\"">\tif (uni.getStorageSync(&quot;access_token_obj&quot;)) &#123; //å¦‚æœaccess_tokenå·²å­˜å…¥ç¼“å­˜ï¼Œè¡¨ç¤ºè¯·æ±‚è¿‡</span><br><span class="\"line\"">\t\tlet obj = uni.getStorageSync(&quot;access_token_obj&quot;);</span><br><span class="\"line\"">\t\tlet nowTime = new Date().getTime();</span><br><span class="\"line\"">\t\tif ((nowTime - obj.requestTime) &gt;= 1000 * 3600 * 24 * 30) &#123; //å¦‚æœä¸Šæ¬¡è¯·æ±‚æ—¶é—´åœ¨30å¤©ä¹‹å‰ï¼Œåˆ™éœ€è¦é‡æ–°è·å–access_token</span><br><span class="\"line\"">\t\t\trequestAccessToken(res =&gt; &#123;</span><br><span class="\"line\"">\t\t\t\trecognition(res, imgData, callback);</span><br><span class="\"line\"">\t\t\t&#125;);</span><br><span class="\"line\"">\t\t&#125; else &#123;</span><br><span class="\"line\"">\t\t\trecognition(obj.access_token, imgData, callback);</span><br><span class="\"line\"">\t\t&#125;</span><br><span class="\"line\"">\t&#125; else &#123; //ç¼“å­˜ä¸­æ²¡æœ‰access_token</span><br><span class="\"line\"">\t\trequestAccessToken(res =&gt; &#123;</span><br><span class="\"line\"">\t\t\trecognition(res, imgData, callback);</span><br><span class="\"line\"">\t\t&#125;);</span><br><span class="\"line\"">\t&#125;</span><br><span class="\"line\"">&#125;</span><br></pre></td></tr></table></figure>\n<figure class="\"highlight" plain\"><table><tr><td class="\"gutter\""><pre><span class="\"line\"">1</span><br><span class="\"line\"">2</span><br><span class="\"line\"">3</span><br><span class="\"line\"">4</span><br><span class="\"line\"">5</span><br><span class="\"line\"">6</span><br><span class="\"line\"">7</span><br><span class="\"line\"">8</span><br><span class="\"line\"">9</span><br><span class="\"line\"">10</span><br><span class="\"line\"">11</span><br><span class="\"line\"">12</span><br><span class="\"line\"">13</span><br><span class="\"line\"">14</span><br><span class="\"line\"">15</span><br><span class="\"line\"">16</span><br><span class="\"line\"">17</span><br><span class="\"line\"">18</span><br></pre></td><td class="\"code\""><pre><span class="\"line\"">//è¯†åˆ«ä¸­...è°ƒç”¨æ–‡å­—è¯†åˆ«API,ä¼ å…¥å›¾ç‰‡æ•°æ®å‚æ•°</span><br><span class="\"line\"">function recognition(access_token, imgData, callback) &#123;</span><br><span class="\"line\"">\tlet params = &#123;</span><br><span class="\"line\"">\t\taccess_token: access_token,</span><br><span class="\"line\"">\t\timage: imgData</span><br><span class="\"line\"">\t&#125;;</span><br><span class="\"line\"">\tlet header = &#123;</span><br><span class="\"line\"">\t\t&apos;Content-Type&apos;: &apos;application/x-www-form-urlencoded&apos;  //è¯·æ±‚å¤´è®¾ç½®æˆå›ºå®šå€¼</span><br><span class="\"line\"">\t&#125;;</span><br><span class="\"line\"">\tnetwork.request(&apos;https://aip.baidubce.com/rest/2.0/ocr/v1/license_plate&apos;, params, header, &quot;POST&quot;, res =&gt; &#123;</span><br><span class="\"line\"">\t\tcallback(res);</span><br><span class="\"line\"">\t&#125;, err =&gt; &#123;</span><br><span class="\"line\"">\t\tuni.showToast(&#123;</span><br><span class="\"line\"">\t\t\ttitle: &quot;è¯·å¯¹å‡†è½¦ç‰Œé‡æ–°æ‹ç…§&quot;,</span><br><span class="\"line\"">\t\t\ticon: &quot;none&quot;</span><br><span class="\"line\"">\t\t&#125;)</span><br><span class="\"line\"">\t&#125;, &quot;è¯†åˆ«ä¸­...&quot;);</span><br><span class="\"line\"">&#125;</span><br></pre></td></tr></table></figure>\n<p>åªè¦å‚æ•°éƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±èƒ½å¾—åˆ°è¿”å›ç»“æœï¼Œè¿”å›è½¦ç‰Œä¿¡æ¯ï¼ˆè½¦ç‰Œå·ã€è½¦ç‰Œé¢œè‰²ç­‰ç­‰ï¼‰ã€‚<br>\nè°ƒç”¨å…¶ä»–åœºæ™¯çš„å›¾ç‰‡è¯†åˆ« API åŒç†ã€‚</p>\n",
            "tags": [
                "H5 APP"
            ]
        }
    ]
}